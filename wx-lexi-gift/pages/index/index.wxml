<!--pages/give/give.wxml-->
<fx-loading loading="{{ isLoading }}"></fx-loading>
<view class="container">
  <view class="gift-banner">
    <view class="title">赠送好友礼物</view>
    <view class="desc">邀请好友访问你的生活馆</view>
  </view>

  <!-- 当前礼物 -->
  <view class="gift-product">
    <view class="product-box">
      <image src="{{ currentActivity.assets[0].view_url }}-p30x2" class="cover" wx:if="{{ currentActivity.assets.length > 0 }}"></image>
      <view class="product-info">
        <view class="name">{{ currentActivity.product_name }}</view>
        <view class="price">
          <text class="sale-price">￥1</text>
          <text class="old-price" wx:if="{{ currentActivity.sale_price > 0 }}">￥{{ currentActivity.sale_price }}</text>
          <text class="old-price" wx:else>￥{{ currentActivity.price }}</text>
        </view>
      </view>
    </view>
    <view class="product-images">
      <image 
        wx:for="{{ currentActivity.assets }}"
        wx:key="{{ item.id }}"
        src="{{ item.view_url }}-p30x2" 
        wx:if="{{ index < 4 && index > 0 }}"
        class="asset"></image>
    </view>
  </view>

  <!-- 设置选项 -->
  <view class="gift-setting">
    <view class="lottery">
      <image src="../../images/icon-gift-box@2x.png" class="icon-gift-box"></image>
      <view class="lottery-summary">
        <view class="title">达到设定参与人数自动开奖</view>
        <view class="sub-title">随机抽取一人获得礼物</view>
      </view>
    </view>

    <view class="form-people">
      <image src="../../images/icon-people@2x.png" class="icon-people"></image>
      <input type="number" placeholder="设定参与人数（不低于20人）" class="form-input" name="people-count" bindfocus="handleValidateLogin" bindblur="handlePeopleNum" value="{{ form.people_num }}" />
    </view>

    <view class="form-blessing">
      <image src="../../images/icon-edit@2x.png" class="icon-edit"></image>
      <input placeholder="填写心愿祝福语（限12个字）" bindfocus="handleValidateLogin" bindblur="handleBlessing" maxlength="12" value="{{ form.blessing }}" class="form-input" />
    </view>

  </view>

  <!-- 领取结果 -->
  <view class="gift-result" wx:if="{{ partakePeopleCount }}">
    <view class="got-result">
      <view class="title">{{ partakePeopleCount }}位领取成功</view>

      <view class="got-people">
        <view class="people-item" wx:for="{{ partakePeople }}" wx:for-item="people" wx:key="{{ people.user_sn }}">
          <image src="{{ people.user_logo }}-ava50" class="icon-avatar" wx:if="{{ people.user_logo }}"></image>
          <view class="name">{{ people.user_name }}</view>
          <view class="date">{{ people.receive_at }}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 支付按钮 -->
  <view class="give-button" bindtap="handleSubmitActivity">
    花一元送好友
  </view>

  <!-- 登陆注册模态框 -->
  <fx-login visible="{{ showLoginModal }}" bind:closeEvent="hanleOffLoginBox"></fx-login>

</view>